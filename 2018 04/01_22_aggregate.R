# link to LinkedIn Learning Video: linkedin-learning.pxf.io/rweekly_aggregate
# Description: Example file for aggregate

idx_affiliate <- "https://linkedin-learning.pxf.io/rweekly_aggregate" # affiliate link to the video
idx_video <- "" # just the name of the video - used for lookup to the URL
idx_task <- "" # optional: This video beongs to this group
# Text for this link. Optional vector - c("main topic", "additional topic", "etc")
idx_topics <- "aggregate()" 
idx_build(idx_affiliate, idx_video, idx_task, idx_topics)

# main idea: aggregate is R for SQL "group by"

# grab some data to work with
data("ChickWeight")

# let's say I want the median weight of each chick
# basic format
aggregate(ChickWeight$weight,  by=list(chkID = ChickWeight$Chick), FUN=median)
aggregate(ChickWeight$weight,  by=list(chkID = ChickWeight$Diet), FUN=median)
# notice it isn't sorted

# use ~ notation
# ~ is for modeling. Left of ~ is "y". Right is model. so y ~ model
# in other words, left of ~ is the result. right of ~ are selectors
aggregate(weight ~ Chick, data=ChickWeight, median)

# list() behaves differently than "~". median needs numeric data
aggregate(weight ~ Chick + Diet, data=ChickWeight, median) # this works

# this doesn't. But it should. Factors don't work with median.
aggregate(x=ChickWeight, 
          by=list(ChickID = ChickWeight$Chick, Dietary=ChickWeight$Diet), 
          median)

# convert factors to numeric
str(fixedChickWeight)
fixedChickWeight <- ChickWeight # make a copy of ChickWeight
fixedChickWeight$Chick <- as.numeric(levels(ChickWeight$Chick)[ChickWeight$Chick])
fixedChickWeight$Diet <- as.numeric(levels(ChickWeight$Diet)[ChickWeight$Diet])
str(fixedChickWeight)

#now this works
aggregate(x=fixedChickWeight, 
          by=list(ChickID = fixedChickWeight$Chick, Dietary=fixedChickWeight$Diet), 
          median)

# Alternatives to aggregate
browseURL("http://dplyr.tidyverse.org/")
browseURL("https://github.com/mnr/R-Language-Mini-Tutorials/blob/master/SQLdf.R")
